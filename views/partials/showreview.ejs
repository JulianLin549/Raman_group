<p>
    <h4>Latest reviews for this store:</h4>
</p>
<hr style="margin-top: 0;">
<% store.reviews.slice(0, 5).forEach(function(review){ %>
<div class="row">
    <div class="col-md-3">
        <div class="star-rating">

            <div class="back-stars">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>

                <div class="front-stars" style="width: <%= review.rating*20 %>%">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                </div>
            </div>
        </div>
        <div>Review by: <strong><%= review.author.username %></strong></div>
        <span><em><%= review.updatedAt.toDateString() %></em></span>
    </div>
    <div class="col-md-9">
        <p style="text-align: justify; word-wrap: break-word;">
            <%= review.text %>
        </p>
        <% if(currentUser && review.author.id.equals(currentUser._id)){ %>
        <a class="btn btn-xs btn-warning" href="/stores/<%=store._id %>/reviews/<%=review._id %>/edit">Edit</a>
        <form id="delete-form" action="/stores/<%=store._id %>/reviews/<%=review._id %>?_method=DELETE" method="POST">
            <input type="submit" class="btn btn-xs btn-danger" value="Delete">
        </form>
        <% } %>
    </div>
</div>
<hr>
<% }); %>
<div style="margin-bottom: 10px;">
    <h4><a href="/stores/<%= store._id %>/reviews"><i class="fa fa-search" aria-hidden="true"></i> See all reviews</a></h4>
</div>

<div>
    <!-- Button trigger modal -->
    <a href="#" id="modalBtn" class="btn btn-lg btn-primary <% if (currentUser && store.reviews.some(function (review) {return review.author.id.equals(currentUser._id)})) { %> disabled <% } %>" data-toggle="modal" data-target="#exampleModalCenter"> 評論或評分</a>
</div>




<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h3 class="modal-title w-100"><i class="fas fa-comment-alt-edit"></i> &nbsp 評分或評論：</h3>

            </div>

            <div class="modal-body">
                <p>店家：<%= store.name %></p>

                <%-include ("../partials/newreview") -%>

            </div>

        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        if ($('#modalBtn').hasClass('disabled')) {
            $('#modalBtn').text('您已經發表評論')
        }
    })
</script>